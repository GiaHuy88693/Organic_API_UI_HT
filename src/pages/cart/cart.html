<div id="header"></div>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  body {
    font-family: "Inter", sans-serif;
    background-color: #f1f3f5;
  }
  .quantity-input {
    border-radius: 0 !important;
    height: 28px;
    padding: 0;
    font-size: 16px;
  }
  .qty-btn {
    border-radius: 50% !important;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 15px;
  }
  .d-flex.justify-content-center.align-items-center {
    gap: 4px;
  }
  .remove-btn-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #f8f9fa;
    border: 1px solid #ccc;
    font-size: 14px;
    color: #666;
    transition: background-color 0.2s ease, color 0.2s ease;
  }
  .remove-btn-icon:hover {
    background-color: #f8d7da;
    color: #dc3545;
  }
</style>

<div class="container my-5">
  <div class="card shadow-sm rounded">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold">Giỏ hàng (2 sản phẩm)</h5>
        <button
          class="btn btn-outline-danger btn-sm"
          onclick="removeAllFromCart()"
        >
          <i class="fas fa-trash me-1"></i> Xóa tất cả
        </button>
      </div>

      <div class="table-responsive" id="cart-table">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Sản phẩm</th>
              <th class="text-center" style="width: 160px">Số lượng</th>
              <th class="text-end" style="width: 120px">Giá</th>
              <th class="text-end ps-2" style="width: 40px"></th>
            </tr>
          </thead>
          <tbody>
            <!-- Sản phẩm mẫu 1 -->
            <tr data-id="1">
              <td class="d-flex align-items-center">
                <img
                  src="/images/product1.jpg"
                  alt="Táo hữu cơ"
                  class="rounded me-3"
                  style="width: 60px; height: 60px; object-fit: cover"
                />
                <div>
                  <div class="fw-semibold">Táo hữu cơ</div>
                </div>
              </td>
              <td class="text-center">
                <div class="d-flex justify-content-center align-items-center">
                  <button
                    class="btn btn-sm btn-outline-secondary qty-btn"
                    onclick="changeQty('1', -1)"
                  >
                    -
                  </button>
                  <input
                    type="text"
                    class="form-control text-center mx-1 px-1 quantity-input"
                    value="2"
                    data-id="1"
                    data-price="35000"
                    style="width: 36px"
                    readonly
                  />
                  <button
                    class="btn btn-sm btn-outline-secondary qty-btn"
                    onclick="changeQty('1', 1)"
                  >
                    +
                  </button>
                </div>
              </td>
              <td class="text-end fw-semibold">35,000₫</td>
              <td class="text-end ps-2">
                <button
                  class="remove-btn-icon"
                  onclick="removeFromCart('1')"
                  title="Remove from cart"
                >
                  <i class="fas fa-trash text-danger"></i>
                </button>
              </td>
            </tr>
            <!-- Sản phẩm mẫu 2 -->
            <tr data-id="2">
              <td class="d-flex align-items-center">
                <img
                  src="/images/product2.jpg"
                  alt="Cam hữu cơ"
                  class="rounded me-3"
                  style="width: 60px; height: 60px; object-fit: cover"
                />
                <div>
                  <div class="fw-semibold">Cam hữu cơ</div>
                </div>
              </td>
              <td class="text-center">
                <div class="d-flex justify-content-center align-items-center">
                  <button
                    class="btn btn-sm btn-outline-secondary qty-btn"
                    onclick="changeQty('2', -1)"
                  >
                    -
                  </button>
                  <input
                    type="text"
                    class="form-control text-center mx-1 px-1 quantity-input"
                    value="1"
                    data-id="2"
                    data-price="45000"
                    style="width: 36px"
                    readonly
                  />
                  <button
                    class="btn btn-sm btn-outline-secondary qty-btn"
                    onclick="changeQty('2', 1)"
                  >
                    +
                  </button>
                </div>
              </td>
              <td class="text-end fw-semibold">45,000₫</td>
              <td class="text-end ps-2">
                <button
                  class="remove-btn-icon"
                  onclick="removeFromCart('2')"
                  title="Remove from cart"
                >
                  <i class="fas fa-trash text-danger"></i>
                </button>
              </td>
            </tr>
            <tr class="table-light fw-bold">
              <td class="text-end" colspan="2">Tổng cộng</td>
              <td class="text-end text-danger" id="cart-total">115,000₫</td>
              <td class="text-end text-danger"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div
        class="d-flex justify-content-between align-items-center mt-3"
        id="cart-actions"
      >
        <a href="/Product" class="btn btn-outline-secondary rounded-pill">
          ← Quay lại cửa hàng
        </a>
        <button id="checkoutBtn" class="btn btn-primary px-4">
          Thanh toán
        </button>
      </div>

      <!-- UI khi giỏ hàng rỗng -->
      <div
        class="text-center py-5 text-muted"
        id="empty-cart"
        style="display: none"
      >
        <i class="fas fa-shopping-cart fa-3x mb-3"></i>
        <p>Giỏ hàng của bạn đang trống.</p>
        <a href="/Product" class="btn btn-success rounded-pill px-4"
          >Tiếp tục mua hàng</a
        >
      </div>
    </div>
  </div>
</div>
<div id="footer"></div>

<script>
  function updateTotal(callback) {
    let total = 0;
    const inputs = document.querySelectorAll(".quantity-input");
    inputs.forEach((input) => {
      const price = parseFloat(input.dataset.price);
      const quantity = Math.max(1, parseInt(input.value));
      total += price * quantity;
    });
    document.getElementById("cart-total").textContent =
      total.toLocaleString("vi-VN") + "₫";
    if (callback) callback();
  }

  function changeQty(id, delta) {
    const row = document.querySelector(`[data-id="${id}"]`);
    const input = row.querySelector(".quantity-input");
    let qty = parseInt(input.value) || 1;
    qty = Math.max(1, qty + delta);
    input.value = qty;
    updateTotal();
  }

  function removeFromCart(productId) {
    const row = document.querySelector(`[data-id="${productId}"]`);
    if (row) row.remove();
    checkEmptyCart();
    updateTotal();
  }

  function removeAllFromCart() {
    if (confirm("Bạn có chắc muốn xóa toàn bộ giỏ hàng?")) {
      document
        .querySelectorAll("tbody tr[data-id]")
        .forEach((row) => row.remove());
      checkEmptyCart();
      updateTotal();
    }
  }

  function checkEmptyCart() {
    const hasItems = document.querySelectorAll("tbody tr[data-id]").length > 0;
    document.getElementById("cart-table").style.display = hasItems
      ? ""
      : "none";
    document.getElementById("cart-actions").style.display = hasItems
      ? ""
      : "none";
    document.getElementById("empty-cart").style.display = hasItems
      ? "none"
      : "";
  }

  document
    .getElementById("checkoutBtn")
    ?.addEventListener("click", async (e) => {
      e.preventDefault();
      await updateTotal();
      alert("Chuyển sang trang thanh toán!");
      // window.location.href = "/cart/checkout";
    });

  // Khởi tạo lại tổng khi load
  updateTotal();
  checkEmptyCart();
  fetch("/src/header.html")
    .then((res) => res.text())
    .then((data) => {
      document.getElementById("header").innerHTML = data;
    });

  fetch("/src/footer.html")
    .then((res) => res.text())
    .then((html) => (document.getElementById("footer").innerHTML = html));
</script>
